# Sitemap Diff - 项目文档

## 项目概述
监控多个网站的 sitemap，检测新增游戏，追踪跨平台游戏。提供 Web Dashboard 进行管理。

## 架构 (V2.0)

```
┌─────────────────────┐     ┌─────────────────┐
│  GitHub Actions     │────▶│  Supabase       │
│  (定时检查 sitemap) │     │  (数据存储)      │
└─────────────────────┘     └────────┬────────┘
                                     │
┌─────────────────────┐              │
│  Web Dashboard      │◀─────────────┘
│  (Vercel Next.js)   │
│  - 游戏浏览         │
│  - Sitemap 管理     │
│  - 统计面板         │
└─────────────────────┘
```

### 组件说明
- **GitHub Actions**: 每 8 小时定时执行 sitemap 检查，无 CPU 限制
- **Supabase**: 存储游戏数据、游戏来源、订阅源
- **Web Dashboard**: Next.js 应用，提供可视化管理界面
  - 实时统计面板
  - 游戏浏览和搜索
  - Sitemap 管理
  - 跨平台游戏追踪

## 目录结构

```
sitemap-diff/
├── lib/                      # 爬虫核心库
│   ├── supabase.js           # Supabase 客户端
│   ├── rss-manager.js        # RSS 管理器（游戏提取）
│   ├── check-sitemaps.js     # 定时检查脚本
│   └── load-env.js           # 环境变量加载
├── web/                      # Web Dashboard (Next.js)
│   ├── src/
│   │   ├── components/       # React 组件
│   │   ├── pages/            # 页面 (Dashboard, Games, Sitemaps)
│   │   ├── lib/              # Supabase 客户端
│   │   └── styles/           # 全局样式
│   ├── public/               # 静态资源
│   └── package.json
├── supabase/
│   ├── schema.sql            # V2 数据库表结构
│   └── migration.sql         # V1→V2 迁移脚本
├── .github/workflows/
│   └── check-sitemaps.yml    # GitHub Actions
├── vercel.json               # Vercel 配置（API + Web）
└── package.json              # 爬虫依赖
```

## 环境变量

### GitHub Actions Secrets
- `SUPABASE_URL` - Supabase 项目 URL
- `SUPABASE_SERVICE_KEY` - Supabase 服务密钥
- `DISCORD_TOKEN` - Discord Bot Token
- `DISCORD_CHANNEL_ID` - Discord 通知频道 ID
- `TELEGRAM_BOT_TOKEN` - Telegram Bot Token
- `TELEGRAM_TARGET_CHAT` - Telegram 目标群组 ID

### Vercel Environment Variables
- `NEXT_PUBLIC_SUPABASE_URL` - Supabase 项目 URL（公开）
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - Supabase 匿名密钥（公开）
- `SUPABASE_SERVICE_KEY` - Supabase 服务密钥（服务端）

## 部署步骤

### 1. 创建 Supabase 项目
1. 在 Supabase 创建新项目
2. 执行 `supabase/schema.sql` 创建表

### 2. 部署 Web Dashboard 到 Vercel
```bash
cd web
npm install
cd ..
vercel deploy --prod
```

在 Vercel 项目设置中添加环境变量：
- `NEXT_PUBLIC_SUPABASE_URL` - 从 Supabase Dashboard 获取
- `NEXT_PUBLIC_SUPABASE_ANON_KEY` - 从 Supabase Dashboard 获取

### 3. 配置 GitHub Actions
在仓库 Settings > Secrets 添加所有环境变量：
- `SUPABASE_URL`
- `SUPABASE_SERVICE_KEY`

### 4. 访问 Dashboard
部署成功后，访问你的 Vercel 域名即可使用管理界面

## 开发命令

### 爬虫
```bash
npm run check    # 本地运行 sitemap 检查
```

### Web Dashboard
```bash
cd web
npm install      # 安装依赖
npm run dev      # 本地开发服务器 (http://localhost:3000)
npm run build    # 构建生产版本
npm start        # 启动生产服务器
```

## Web Dashboard 功能

### 📊 Dashboard 页面
- 实时统计卡片（总游戏数、平台数、跨平台游戏、高分游戏）
- Top 6 跨平台游戏展示
- 系统状态指示器

### 🎮 Games 页面
- 所有游戏列表（按分数排序）
- 搜索功能（游戏名称）
- 筛选功能：
  - 按平台数量（2+, 3+, 4+）
  - 按域名
- 每个游戏显示：
  - 游戏名称和 ID
  - 平台数量 badge
  - 推荐分数（带进度条）
  - 所有平台链接

### 🗺️ Sitemaps 页面
- 所有配置的 sitemap 列表
- 添加新 sitemap（URL 输入）
- 删除 sitemap
- 显示域名、添加时间、更新时间

## 设计特色

- **赛博朋克霓虹风格**：青色+洋红色+黄色的霓虹配色
- **独特字体**：Rajdhani（显示）+ JetBrains Mono（代码）
- **流畅动画**：数字计数、卡片悬浮、页面加载
- **响应式设计**：完美支持移动端和桌面端
